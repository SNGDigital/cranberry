<!-- Bower Dependencies -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/byutv-jsonp/byutv-jsonp.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/page-title/page-title.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation-runner-behavior.html">
<!-- Custom Dependencies -->
<link rel="import" href="../cranberry-related-content/cranberry-related-content.html">
<link rel="import" href="../cranberry-story-byline/cranberry-story-byline.html">
<link rel="import" href="../cranberry-story-media/cranberry-story-media.html">
<link rel="import" href="../cranberry-story-paragraphs/cranberry-story-paragraphs.html">
<link rel="import" href="../cranberry-story-request/cranberry-story-request.html">
<link rel="import" href="../gigya-comments/gigya-comments.html">
<link rel="import" href="../gigya-sharebar/gigya-sharebar.html">
<link rel="import" href="../gigya-top-comments/gigya-top-comments.html">
<link rel="import" href="../google-dfp/google-dfp.html">
<link rel="import" href="../google-survey/google-survey.html">
<link rel="import" href="../tout-element/tout-element.html">
<link rel="import" href="../youneeq-content/youneeq-content.html">

<dom-module id="cranberry-story">

  <template>
    <style>
      @import "cranberry-story/cranberry-story";
    </style>

    <iron-media-query query="(min-width: 960px)" query-matches="{{desktop}}"></iron-media-query>
    <iron-media-query query="(min-width: 720px) and (max-width:959px)" query-matches="{{tablet}}"></iron-media-query>
    <iron-media-query query="(max-width:719px)" query-matches="{{mobile}}"></iron-media-query>

    <app-route route="{{route}}" pattern="/:id" data="{{routeData}}"></app-route>

    <page-title base-title="{$ config.title $}" title="[[story.title]]"></page-title>

    <!-- Story Request Element -->
    <cranberry-story-request page-id="[[routeData.id]]"
                             error="{{error}}"
                             response="{{response}}"
                             request-in-progress="{{requestLoading}}"
                             static-page$="[[staticPage]]"
                             current-page-id="{{storyId}}"
                             hidden$="[[hidden]]">
    </cranberry-story-request>
    <!-- Content Loaded Display -->
    <div hidden$="[[!storyDoneLoading]]">
      <div class="cranberry-story">
        <template is="dom-if" if="[[!staticPage]]">
          <!-- Main Header Ad -->
          <div class="banner-advertisement">
            <google-dfp
              section="[[response.sectionInformation.sectionName]]"
              section-parent="[[response.sectionInformation.sectionParentName]]"
              tags="[[response.tags]]"
              ad-pos="leaderboard"
              ad-size-mapping="leaderboard"
              ad-size="[[970, 250],[970, 90],[728, 90],[320, 50]]"
              ad-group="{$ config.dfpAdStructure.adGroupID $}"
              ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
              ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
              ad-placement="{$ config.dfpAdPlacement $}"
              id="topAd"
              hidden$="[[hidden]]">
            </google-dfp>
          </div>
        </template> 

        <!-- Error Display -->
        <template is="dom-if" if="[[error.errorCode]]">
          <h1>[[error.errorMessage]]</h1>
        </template>
        <!-- Content Display -->
        <template is="dom-if" if="[[!error.errorCode]]">
          <div class="story-content-wrapper" hidden$="[[loading]]">

            <div class="headline">
              <h1 class="story-title">[[response.title]]</h1>
              <p class="time-stamp" hidden$="[[staticPage]]">[[response.updated]]</p>
            </div>

            <div class="media-asset">
              <cranberry-story-media
                attachments="[[response.attachments]]"
                base-domain="{$ config.baseDomain $}"
                content="[[response]]"
                has-shortcode$="[[hasLeadShortcode]]"
                hidden$="[[_computeMediaHidden(staticPage, hidden)]]"
                lead-shortcode-type="[[leadShortcodeType]]"
                lead-shortcode-content="[[leadShortcodeContent]]"
                media="[[response.mediaAssets.images]]"
                my-capture-url="{$ config.myCaptureUrl $}"
                route="[[route]]"
                videos="[[response.mediaAssets.videos]]">
              </cranberry-story-media>
            </div>

            <!-- Story Byline -->
            <div class="byline-container" hidden$="[[staticPage]]">
              <cranberry-story-byline byline="[[response.byline]]"
                                      base-domain="{$ config.baseDomain $}"
                                      display-byline="{{byline}}">
              </cranberry-story-byline>
            </div>

            <!-- Story Content Area -->
            <div class="content-wrapper">
              <!-- Contains story paragraphs -->
              <div class="story-content">
                <cranberry-story-paragraphs paragraphs-loading="{{paragraphsLoading}}"
                                            story="[[response]]"
                                            tout-uid="{$ config.tout.toutUid $}"
                                            gcs-survey-id="{$ config.google.surveys $}"
                                            distro-id="{$ config.distro.distroId $}"
                                            mobile$="[[mobile]]"
                                            desktop$="[[desktop]]"
                                            surveys-off="[[response.surveysOff]]"
                                            tout-off="[[response.toutOff]]"
                                            section-information="[[response.sectionInformation]]"
                                            static-page$="[[staticPage]]"
                                            base-domain="{$ config.baseDomain $}"
                                            paragraphs="[[response.paragraphs]]"
                                            ad-group="{$ config.dfpAdStructure.adGroupID $}"
                                            ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
                                            ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
                                            hidden$="[[hidden]]">
                </cranberry-story-paragraphs>
                <div class="ntv-ad-div"></div>
              </div>
              <!-- Contains Right Rail -->
              <div class="right-rail">
                <div>
                  <google-dfp
                    section="[[response.sectionInformation.sectionName]]"
                    section-parent="[[response.sectionInformation.sectionParentName]]"
                    tags="[[response.tags]]"
                    ad-pos="Top_of_Stream"
                    ad-size="[[300, 250],[300, 600]]"
                    ad-group="{$ config.dfpAdStructure.adGroupID $}"
                    ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
                    ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
                    ad-placement="{$ config.dfpAdPlacement $}"
                    id="sideAd"
                    hidden$="[[hidden]]">
                  </google-dfp>

                  <gigya-top-comments count="5" age="90"></gigya-top-comments>

                  <cranberry-related-content related-items="[[response.relatedContent]]" story></cranberry-related-content>
                  <div class="ntv-ad-div"></div>
                  <div class="tout-sdk tout-right-rail-embed"></div>
                  <google-dfp
                    section="[[response.sectionInformation.sectionName]]"
                    section-parent="[[response.sectionInformation.sectionParentName]]"
                    tags="[[response.tags]]"
                    ad-pos="Sidebar_promo"
                    ad-size="[[300, 100],[300, 250],[300, 600]]"
                    ad-group="{$ config.dfpAdStructure.adGroupID $}"
                    ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
                    ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
                    ad-placement="{$ config.dfpAdPlacement $}"
                    hidden$="[[hidden]]">
                  </google-dfp>
                  <cranberry-related-content related-items="[[response.relatedContent]]" gallery></cranberry-related-content>
                </div>
              </div>
            </div>

            <!-- Middle Ad -->
            <div class="banner-advertisement">
              <google-dfp
                section="[[response.sectionInformation.sectionName]]"
                section-parent="[[response.sectionInformation.sectionParentName]]"
                tags="[[response.tags]]"
                ad-pos="Middle_of_Stream"
                ad-size-mapping="mobileLeader"
                ad-size="[[970, 250],[970, 90],[728, 90],[300, 250]]"
                ad-group="{$ config.dfpAdStructure.adGroupID $}"
                ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
                ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
                ad-placement="{$ config.dfpAdPlacement $}"
                hidden$="[[hidden]]">
              </google-dfp>
            </div>

            <template is="dom-if" if="[[!staticPage]]">
              <!-- Comments -->
              <div class="comments-wrappper">
                <gigya-comments stream-id="[[response.genericLink]]" content="[[response]]" config-id="{$ config.gigya.commentsId $}"></gigya-comments>
              </div>
              
              <!-- Bottom Ad -->
              <div class="banner-advertisement">
                <google-dfp
                  section="[[response.sectionInformation.sectionName]]"
                  section-parent="[[response.sectionInformation.sectionParentName]]"
                  tags="[[response.tags]]"
                  ad-pos="Bottom_of_Stream"
                  ad-size-mapping="mobileLeader"
                  ad-size="[[970, 250],[970, 90],[728, 90],[300, 250]]"
                  ad-group="{$ config.dfpAdStructure.adGroupID $}"
                  ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
                  ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
                  ad-placement="{$ config.dfpAdPlacement $}"
                  hidden$="[[hidden]]">
                </google-dfp>
              </div>

              <!-- Youneeq Content Area -->
              <div class="youneeq-wrapper">
                <youneeq-content content="[[response]]" domain="{$ config.baseDomain $}" hidden$="[[hidden]]"></youneeq-content>
              </div>
            </template>
          </div>
        </template>
        
        <template is="dom-if" if="[[!staticPage]]">
          <!-- Last Ad -->
          <div class="banner-advertisement">
            <google-dfp
              section="[[response.sectionInformation.sectionName]]"
              section-parent="[[response.sectionInformation.sectionParentName]]"
              tags="[[response.tags]]"
              ad-pos="Last_of_Stream"
              ad-size-mapping="leaderboard"
              ad-size="[[970, 250],[970, 90],[728, 90],[320, 50]]"
              ad-group="{$ config.dfpAdStructure.adGroupID $}"
              ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
              ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
              ad-placement="{$ config.dfpAdPlacement $}"
              hidden$="[[hidden]]">
            </google-dfp>
          </div>
        </template>
      </div>

      <google-dfp
        section="[[response.sectionInformation.sectionName]]"
        section-parent="[[response.sectionInformation.sectionParentName]]"
        ad-pos="adhesion"
        ad-group="{$ config.dfpAdStructure.adGroupID $}"
        ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
        ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
        ad-placement="{$ config.dfpAdPlacement $}"
        out-of-page
        hidden$="[[hidden]]">
      </google-dfp>

      <google-dfp
        section="[[response.sectionInformation.sectionName]]"
        section-parent="[[response.sectionInformation.sectionParentName]]"
        ad-pos="interstitial"
        ad-group="{$ config.dfpAdStructure.adGroupID $}"
        ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
        ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
        ad-placement="{$ config.dfpAdPlacement $}"
        out-of-page
        hidden$="[[hidden]]">
      </google-dfp>
    </div>

    <!-- Loading Content Display -->
    <template is="dom-if" if="[[!storyDoneLoading]]">
      <div class="loading-container" hidden$="[[storyDoneLoading]]">
        <paper-spinner active$="[[!storyDoneLoading]]"></paper-spinner>
        <p>Fetching Your Content...</p>
      </div>
    </template>
  </template>

  <!-- Add cranberry-story Polymer Object script -->
  <script src="cranberry-story.js"></script>

</dom-module>
