<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/byutv-jsonp/byutv-jsonp.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/page-title/page-title.html">
<link rel="import" href="../cranberry-shortcode/cranberry-shortcode.html">
<link rel="import" href="../youneeq-content/youneeq-content.html">
<link rel="import" href="../gigya-comments/gigya-comments.html">
<link rel="import" href="../gigya-sharebar/gigya-sharebar.html">
<link rel="import" href="../google-dfp/google-dfp.html">
<link rel="import" href="../tout-element/tout-element.html">
<link rel="import" href="../gigya-top-comments/gigya-top-comments.html">
<link rel="import" href="../cranberry-related-content/cranberry-related-content.html">
<link rel="import" href="../google-survey/google-survey.html">

<dom-module id="cranberry-story">

  <template>
    <style>
      @import "cranberry-story/cranberry-story";
    </style>

    <iron-media-query query="(min-width: 960px)" query-matches="{{desktop}}"></iron-media-query>
    <iron-media-query query="(min-width: 720px) and (max-width:959px)" query-matches="{{tablet}}"></iron-media-query>
    <iron-media-query query="(max-width:719px)" query-matches="{{mobile}}"></iron-media-query>

    <app-route route="{{route}}" pattern="/:id" data="{{routeData}}"></app-route>

    <page-title base-title="{$ config.title $}" title="[[story.title]]"></page-title>

    <byutv-jsonp cache on-response="_handleResponse" id="storyRequest"></byutv-jsonp>

    <div class="Cranberry-Story">
      <div class="ut-center">
        <google-dfp
          section="[[story.sectionInformation.sectionName]]"
          section-parent="[[story.sectionInformation.sectionParentName]]"
          tags="[[story.tags]]"
          ad-pos="leaderboard"
          ad-size-mapping="leaderboard"
          ad-size="[[970, 250],[970, 90],[728, 90],[320, 50]]"
          ad-group="{$ config.dfpAdStructure.adGroupID $}"
          ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
          ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
          id="topAd"
          hidden$="[[hidden]]">
        </google-dfp>
      </div>

      <!-- Headline -->
      <h1 class="story-title"> [[story.title]] </h1>
      <p class="time-stamp"> [[story.updated]] </p>

      <!-- Story Media -->
      <div class="story-media" hidden$="[[_checkMedia(story.mediaAssets)]]">
        <div class="media-container" id="mediaContainer"  desktop-layout$="[[desktop]]" tablet-layout$="[[tablet]]" mobile-layout$="[[mobile]]">
          <iron-image id="mainImage" sizing="cover" src$="{$ config.baseDomain $}[[story.mediaAssets.images.0.exlarge]]" hidden$="[[hasLeadShortcode]]"></iron-image>
          <div id="leadShortcode" hidden$="[[!hasLeadShortcode]]"></div>
          <!-- TOUT TAP -->
          <!--<div id="toutTap" hidden$="[[!hasToutTap]]"></div>-->
        </div>
        <div class="ut-rowFlex ut-absolute">
          <paper-fab mini icon="communication:chat-bubble" title="Comments" id="commentButton" class="ut-small-icon-margin"></paper-fab>
          <gigya-sharebar share-buttons-id="gigya-share-buttons-story" title="[[story.title]]" route="[[route]]"></gigya-sharebar>
        </div>
      </div>

      <div class="main-image-subtext" mobile-layout$="[[mobile]]" tablet-layout$="[[tablet]]">
        <p class="caption-text">[[story.mediaAssets.images.0.caption]] <span>--[[story.mediaAssets.images.0.credit]]</span>
      </div>

      <!-- Story Byline -->
      <template is="dom-if" if="[[hasProfile]]">
        <a class="byline-link" href="[[byline.profileUrl]]" ga-on="click" ga-event-category="Story Byline Clicked" ga-event-action="uti_prf_str_byline">
          <div class="body-text by-line-wrapper">
            <img src="[[_computeBylineImageURL(byline.image)]]" class="ut-circle-image"/>
            <div class="by-line-info">
              <p>[[byline.title]]</p>
              <p>[[byline.location]]</p>
              <p>[[byline.jobtitle]]</p>
            </div>
          </div>
        </a>
      </template>

      <template is="dom-if" if="[[!hasProfile]]">
        <div class="body-text by-line-wrapper">
          <img src="[[_computeBylineImageURL(byline.image)]]" class="ut-circle-image"/>
          <div class="by-line-info">
            <p>[[byline.title]]</p>
            <p>[[byline.location]]</p>
            <p>[[byline.jobtitle]]</p>
          </div>
        </div>
      </template>

      <!-- Story Content Area -->
      <div class="content-wrapper">
        <!-- Contains story paragraphs -->
        <div class="story-content">
          <div class="body-text" id="storyContentArea"></div>
          <div class="ntv-ad-div"></div>
        </div>
        <!-- Contains Right Rail -->
        <div class="right-rail">
          <div>
            <google-dfp
              section="[[story.sectionInformation.sectionName]]"
              section-parent="[[story.sectionInformation.sectionParentName]]"
              tags="[[story.tags]]"
              ad-pos="Top_of_Stream"
              ad-size="[[300, 250],[300, 600]]"
              ad-group="{$ config.dfpAdStructure.adGroupID $}"
              ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
              ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
              id="sideAd"
              hidden$="[[hidden]]">
            </google-dfp>

            <gigya-top-comments count="5" age="90"></gigya-top-comments>

            <cranberry-related-content related-items="[[story.relatedContent]]" story></cranberry-related-content>
            <div class="ntv-ad-div"></div>
            <div class="tout-sdk tout-right-rail-embed"></div>
            <google-dfp
              section="[[story.sectionInformation.sectionName]]"
              section-parent="[[story.sectionInformation.sectionParentName]]"
              tags="[[story.tags]]"
              ad-pos="Sidebar_promo"
              ad-size="[[300, 100],[300, 250],[300, 600]]"
              ad-group="{$ config.dfpAdStructure.adGroupID $}"
              ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
              ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
              hidden$="[[hidden]]">
            </google-dfp>
            <cranberry-related-content related-items="[[story.relatedContent]]" gallery></cranberry-related-content>
          </div>
        </div>
      </div>

      <!-- Middle Ad -->
      <div class="ut-center">
        <google-dfp
          section="[[story.sectionInformation.sectionName]]"
          section-parent="[[story.sectionInformation.sectionParentName]]"
          tags="[[story.tags]]"
          ad-pos="Middle_of_Stream"
          ad-size-mapping="leaderboard"
          ad-size="[[970, 250],[970, 90],[728, 90],[320, 50]]"
          ad-group="{$ config.dfpAdStructure.adGroupID $}"
          ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
          ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
          hidden$="[[hidden]]">
        </google-dfp>
      </div>

      <!-- Comments -->
      <div class="ut-center">
        <gigya-comments stream-id="[[story.genericLink]]" content="[[story]]" config-id="{$ config.gigya.commentsId $}"></gigya-comments>
      </div>

      <!-- Bottom Ad -->
      <div class="ut-center">
        <google-dfp
          section="[[story.sectionInformation.sectionName]]"
          section-parent="[[story.sectionInformation.sectionParentName]]"
          tags="[[story.tags]]"
          ad-pos="Last_of_Stream"
          ad-size-mapping="leaderboard"
          ad-size="[[970, 250],[970, 90],[728, 90],[320, 50]]"
          ad-group="{$ config.dfpAdStructure.adGroupID $}"
          ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
          ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
          hidden$="[[hidden]]">
        </google-dfp>
      </div>

      <!-- Youneeq Content Area -->
      <div class="youneeq-wrapper">
        <youneeq-content content="[[story]]" domain="{$ config.baseDomain $}" hidden$="[[hidden]]"></youneeq-content>
      </div>

      <!-- Last Ad -->
      <div class="ut-center">
        <google-dfp
          section="[[story.sectionInformation.sectionName]]"
          section-parent="[[story.sectionInformation.sectionParentName]]"
          tags="[[story.tags]]"
          ad-pos="Last_of_Stream"
          ad-size-mapping="leaderboard"
          ad-size="[[970, 250],[970, 90],[728, 90],[320, 50]]"
          ad-group="{$ config.dfpAdStructure.adGroupID $}"
          ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
          ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
          hidden$="[[hidden]]">
        </google-dfp>
      </div>

      <google-dfp
        section="[[story.sectionInformation.sectionName]]"
        section-parent="[[story.sectionInformation.sectionParentName]]"
        ad-pos="adhesion"
        ad-group="{$ config.dfpAdStructure.adGroupID $}"
        ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
        ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
        out-of-page
        hidden$="[[hidden]]">
      </google-dfp>

      <google-dfp
        section="[[story.sectionInformation.sectionName]]"
        section-parent="[[story.sectionInformation.sectionParentName]]"
        ad-pos="interstitial"
        ad-group="{$ config.dfpAdStructure.adGroupID $}"
        ad-grouping="{$ config.dfpAdStructure.adGrouping $}"
        ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"
        out-of-page
        hidden$="[[hidden]]">
      </google-dfp>

  </template>

  <!-- Add cranberry-story Polymer Object script -->
  <script src="cranberry-story.js"></script>

</dom-module>
