<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/byutv-jsonp/byutv-jsonp.html">
<link rel="import" href="../google-dfp/google-dfp.html">
<link rel="import" href="../cranberry-search-bar/cranberry-search-bar.html">
<link rel="import" href="../cranberry-pagination/cranberry-pagination.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">

<dom-module id="cranberry-search">
  <template>
    <style>
      @import "cranberry-search/cranberry-search";
    </style>

    <iron-media-query query="(min-width: 960px)" query-matches="{{desktop}}"></iron-media-query>
    <iron-media-query query="(min-width: 720px) and (max-width:959px)" query-matches="{{tablet}}"></iron-media-query>
    <iron-media-query query="(max-width: 719px)" query-matches="{{mobile}}"></iron-media-query>

    <app-route route="{{route}}" pattern="/:section" data="{{routeData}}"></app-route>

    <byutv-jsonp
      on-response="_handleResponse"
      on-load="_handleLoad"
      last-response="{{response}}"
      last-request="{{request}}"
      last-error="{{error}}"
      id="searchRequest">
    </byutv-jsonp>

    <div class="ad-container">
      <google-dfp section="[[loadSection]]" ad-pos="leaderboard" ad-size="[[728, 90],[970, 90],[970, 250]]" ad-group="{$ config.dfpAdStructure.adGroupID $}" ad-grouping="{$ config.dfpAdStructure.adGrouping $}" ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"></google-dfp>
    </div>

    <paper-material elevation=1>
      <div class="main-content">
        <div class="vertical-container">
          <div class="landing-display" hidden$="[[!noQuery]]">
            <p class="landing-text">Enter your search below to start:</p>
          </div>
          <paper-material elevation=2>
            <cranberry-search-bar></cranberry-search-bar>
          </paper-material>
          <!-- Overlay spinner for user notification of loading -->
          <div id="loader" class="loading" hidden$="[[!isSearching]]">
            <p>Finding Stories Containing "[[displayQuery]]"...</p>
            <paper-spinner active="[[isSearching]]"></paper-spinner>
          </div>
          <!-- Main content area for search results. -->
          <div id="searchContent" class="search-container" hidden$="[[_hideResultsArea(isSearching, noQuery)]]">
            <div class="search-header-container">
              <h1 class="result-header">Results for: [[displayQuery]]</h1>
              <p class="total-results">About: [[totalResults]] results</p>
            </div>
            <template is="dom-repeat" items="{{items}}">
              <a href="/story/[[item.itemId]]"
                 ga-on="click"
                 ga-event-category="Search Result Clicked"
                 ga-event-action$="uti_srch_item_[[index]]">
                <h2 class="story-headline">[[item.title]]</h2>
                <div class="story-content">
                  <template is="dom-if" if="[[_hasImage(item.mediaAssets.images.0.small)]]">
                    <iron-image src="{$ config.baseDomain $}[[item.mediaAssets.images.0.small]]" style="background-color: lightgray;" preload></iron-image>
                  </template>
                  <p class="story-description">[[_trimText(item.preview, desktop, tablet, mobile)]]</p>
                </div>
              </a>
              <hr class="break" />
            </template>
          </div>
        </div>
        <div class="right-rail">
          <div class="ad-container">
            <google-dfp section="[[loadSection]]" ad-pos="Top_of_Stream" ad-size="[[300, 250],[300, 600]]" ad-group="{$ config.dfpAdStructure.adGroupID $}" ad-grouping="{$ config.dfpAdStructure.adGrouping $}" ad-sub-grouping="{$ config.dfpAdStructure.adSubGrouping $}"></google-dfp>
          </div>
        </div>
      </div>
      <div class="pagination-wrapper" hidden$="[[_hideResultsArea(isSearching, noQuery)]]">
        <cranberry-pagination start="{{start}}" current-page="[[currentPage]]" count="20"></cranberry-pagination>
      </div>
    </paper-material>
  </template>
  <script src="cranberry-search.js"></script>
</dom-module>
